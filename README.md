# Node Starter

A Node server folder structure.

## Folder structure

Generated by [mmdir](https://www.npmjs.com/package/mddir)
<!-- run mddir and copy directiryList.md -->

See detailed information below.

The list is ordered by folder complexity: from least complex to "absolute mess".

- tmp/

  **Do not delete the temp folder**. It's used by upload services. It doesn't have `.gitkeep` files by mistake.

  You can delete files commited by mistake but not the folders inside it.

  - src/

  Where all code is located

    - @types/

    Custom types for typescript. Name template: `_filename_.d.ts` (the `d` stands for `definition`).

    - config/

      Add here default configuration for the whole project. All of the files are filled through `.env`.

    - auth.ts

    JWT secret and expiration date

    - cache.ts

    Cache configuration. In this file, Redis (but I might change)

    - mail.ts

    E-mail provider configuration, defauts to Ethereal.

    - upload.ts

    Configs upload folder with `multer` and AWS bucket

  - shared/

  Files shared by whole project, without specific use or componentization.

    - infra/

    These files open the server to the web. They're about infrastructure, like server:database communication (using `typeorm`) and routes & middlewares. It's here that the main `server.ts` file is located.

      - typeorm/

        - index.ts

        Only opens connections with `typeorm`. Feeds on `ormconfig.json` from `root`.

        - migrations/

        Every new change in database should be made using migrations to keep database integrity.

        To create a new migration, run `yarn typeorm migration:create -n name`, then edit file created inside this folder. The `name` has to be TitleCase and __very__ descriptive. Eg: `ChangeProviderFieldToProviderId`

        To run migrations and consolidate in server, run `yarn typeorm migration:run`

        To revert a migration, `yarn typeorm migration:revert`

## Root files walkthrough

- .gitignore: Ignores files and folders from git
- .env: It's imperative to have a `.env` file following `.env.example`. Fill the missing information before running server.
- .eslintignore: Ignores files and folders from eslint
- .eslintrc.json: Eslint configuration file
- babel.config.js: Babel configuration file
- jest.config.js: Jest configuration file
- ormconfig.json: Server Usage configuration file. Follow `ormconfig.example.json`.
- prettier.config.js: Prettier configuration file
- tsconfig.json: Typescript configuration file
- package.json: see below

## Package.json walkthrough

### Scripts

- `build`: parses typescript into `dist` folder
- `dev:server`: development server
- `start`: runs server
- `test`: runs `jest` tests
- `typeorm`: runs `typeorm` commands, like creating and running migrations

### Dependencies

- dotenv: loads `.env` files
- express: makes all the server _magic_ happen
- express-async-errors: async/await in express
- rate-limiter-flexible: protects the server from DDoS and brute force
- uuidv4: generates unique ids

### Dev Dependencies

#### Babel & Typescript

- typescript: types!
- @babel/cli, core, env & node: Needed package for Babel transpile.
- @babel/preset-typescript: Preset for typescript usage
- @babel/plugin-proposal-class-decorators: Allows Typescript @decorators
- babel-plugin-transform-typescript-metadata: usage with decorators
- @babel/plugin-proposal-class-properties: Transforms static class properties as well as properties declared with the property initializer syntax. [Source](https://www.npmjs.com/package/@babel/plugin-proposal-class-properties)
- babel-plugin-module-resolver: best pathing, see [source](https://github.com/tleunen/babel-plugin-module-resolver)


#### Eslint

All below: configuration for `eslint` and `typescript`, using `airbnb` as base.

- eslint
- eslint-config-airbnb-base
- eslint-plugin-import
- eslint-import-resolver-typescript
- @typescript-eslint/eslint-plugin
- @typescript-eslint/parser

Working alongside `eslint` is `prettier`:

- prettier
- eslint-plugin-prettier
- eslint-config-prettier

#### Others

- jest: testing tool
- ts-jest: `jest` with `typescript`
- ts-node-dev: like `nodemon` but for `typescript` and `node`
- tsconfig-paths: best pathing (`paths` in `tsconfig`), eg `@module/file.ts` instead of `src/path/to/file/file.ts`






